{extend name="/Common/baseHome" /}

{block name="css"}

<link rel="stylesheet" href="__CSS__/curd.css"/>
<style type="text/css">
.list_table tbody tr>th{
    text-align: right;
}
.list_table .parts_table th{
    text-align: left;
}
.view_status{
    display: block;
    overflow: hidden;
    margin-left:30px;
    min-width: 1010px;
}
.view_status li{
    float: left;
    width: 120px;
    height: 80px;
    position: relative;
}
.view_status h3{
    position: absolute;
    width: 120px;
    text-align: center;
    top: 15px;
    left: 0px;
}

.view_status .status_yuan{
    margin-top: 33px;
    width: 10px;
    height: 10px;
    border-radius: 10px;
    float: left;
    border:2px solid #999999;
}
.view_status .status_xian{
    width: 106px;
    height: 4px;
    margin-top:38px;
    float: left;
    background-color: #999999;
}.view_status li.on>.status_yuan{
    border-color: #F50;
}
.view_status li.on>.status_xian{
    border-color: #F50;
    background-color: #F50;
}


</style>
{/block}

{block name="body"}



<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    <legend>{$headArr.title}</legend>
</fieldset>
 


<div class="view_status">
    <ul>
        
        <li class="on">
            <h3>提交人</h3>
            <div class="status_yuan"></div>
            <div class="status_xian"></div>
        </li>
        
        <li class="{if condition='$data.status2 eq 2'}on{/if}">
            <h3>{$role_data.1.role_name}</h3>
            <div class="status_yuan"></div>
            <div class="status_xian"></div>
        </li>

        <li class="{if condition='$data.status3 eq 2'}on{/if}">
            <h3>{$role_data.2.role_name}</h3>
            <div class="status_yuan"></div>
            <div class="status_xian"></div>
        </li>

        <li class="{if condition='$data.status4 eq 2'}on{/if}">
            <h3>{$role_data.3.role_name}</h3>
            <div class="status_yuan"></div>
            <div class="status_xian"></div>
        </li>

        <li class="{if condition='$data.status5 eq 2'}on{/if}">
            <h3>{$role_data.4.role_name}</h3>
            <div class="status_yuan"></div>
            <div class="status_xian"></div>
        </li>

        <li class="{if condition='$data.status6 eq 2'}on{/if}">
            <h3>{$role_data.5.role_name}</h3>
            <div class="status_yuan"></div>
            <div class="status_xian"></div>
        </li>

        <li class="{if condition='$data.status7 eq 2'}on{/if}">
            <h3>{$role_data.6.role_name}</h3>
            <div class="status_yuan"></div>
            <div class="status_xian"></div>
        </li>

    </ul>
</div>




<table class="layui-table list_table">
    <colgroup>
        <col width="200">
        <col>
    </colgroup>
    <thead>
        <!-- <tr>
          <th>人物</th>
          <th>民族</th>
        </tr>  -->
    </thead>
    <tbody>

        <tr>
            <th>文件编号：</th>
            <td>{$data.order_num}</td>
        </tr>

        <tr>
            <th>录入时间：</th>
            <td>{$data.add_time|date="Y-m-d",###}</td>
        </tr>

        <tr>
            <th>检验员：</th>
            <td>{$data.username}</td>
        </tr>

        <tr>
            <th>服务站名称：</th>
            <td>{$data.role_name}</td>
        </tr>

        <tr>
            <th>标题：</th>
            <td>{$data.title}</td>
        </tr>
        
        <tr>
            <th>类型：</th>
            <td>{$data.type_name}</td>
        </tr>

        <tr>
            <th>责任部门：</th>
            <td>{$data.department}</td>
        </tr>

        <tr>
            <th>产品型号与名称：</th>
            <td>{$data.product_code}</td>
        </tr>
        <tr>
            <th>发生位置：</th>
            <td>{$data.happen_position}</td>
        </tr>


        <tr>
            <th>零件图号和名称：</th>
            <td>{$data.part_code}</td>
        </tr>

        <tr>
            <th>零件数量：</th>
            <td>{$data.part_num}</td>
        </tr>

        <tr>
            <th>问题描述和原因分析：</th>
            <td>{$data.description}</td>
        </tr>

        <tr>
            <th>处理人：</th>
            <td>{$data.chuli_user}</td>
        </tr>

        <tr>
            <th>处理措施：</th>
            <td>{$data.chuli_cuoshi}</td>
        </tr>

        <tr>
            <th>处理时间：</th>
            <td>{$data.chuli_time}</td>
        </tr>
        <tr>
            <th>备注</th>
            <td>{$data.beizhu}</td>
        </tr>
        


        <tr>
            <th>图片：</th>
            <td>
                <table class="layui-table parts_table" style="width:350px; margin-left: 1px;">
                <colgroup>
                    <col width="100">
                    <col>
                </colgroup>
                <thead>
                    <tr>
                        <th>预览</th>
                    </tr> 
                </thead>

                <tbody>
                    {foreach name="img_data" item="v" key="key"} 
                    <tr class="parts_list">
                        <td>
                            <a class="example" href="/{$v.src}">
                                <img src="/{$v.src_300}" style="display: inline;width: 300px;" />
                            </a>
                        </td>
                    </tr>
                    {/foreach}
                    
                </tbody>

                </table>
            </td>
        </tr>


    </tbody>
</table>




<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
  <legend>审批信息</legend>
</fieldset>

{foreach name="view_data" item="v" key="key"}
<table class="layui-table" style="margin-top: 10px;">
    <colgroup>
        <col width="150">
        <col>
    </colgroup>
    <thead>
    </thead>
    <tbody>
        <tr>
            <th>部门：</th>
            <td>{$v.role_name}</td>
        </tr>
        <tr>
            <th>是否通过</th>
            <td>
                {eq name="$v.view_status" value="2"}
                通过
                {else/}驳回
                {/eq}
            </td>
            
        </tr>
        <tr>
            <th>审批意见</th>
            <td>
                {$v.view_content}
            </td>
        </tr>
    </tbody>
</table>
{/foreach}



<!-- 只有能审批的人才可以进行修改 -->
{if condition="  $Think.session.role_id eq 2 || $Think.session.role_id eq 3 || $Think.session.role_id eq 4 ||$Think.session.role_id eq 5 ||$Think.session.role_id eq 6 || $Think.session.role_id eq 7 "}


<form id="map"  class="layui-form">  
<table class="layui-table" style="margin-top: 20px;">
    <colgroup>
        <col width="150">
        <col>
    </colgroup>
    <thead>
    </thead>
    <tbody>

        <tr>
            <th>部门：</th>
            <td>
                <input type="text" name="group_name"  lay-verify="title" autocomplete="off" class="layui-input group_name" value="{$Think.session.role_name}" >
            </td>
        </tr>

        <tr>
            <th>是否通过</th>
            <td>
                <input type="radio" name="group_status" value="2" title="通过" checked="">
                <input type="radio" name="group_status" value="3" title="驳回">
            </td>
        </tr>

        {if condition="$Think.session.role_id gt 1 && $Think.session.role_id lt 7 "}
        <tr>
            <th>选择审批人</th>
            <td>

                <div class="layui-input-inline">
                    <select name="admin_id" lay-verify="required">
                        {foreach $role_user as $v} 
                            {if condition="$Think.session.role_id+1 eq $v.role_id "}
                            <option value="{$v.admin_id}">{$v.username}</option>
                            {/if}
                        {/foreach}
                    </select>
                </div>

            </td>
        </tr>
        {/if}

        <tr>
            <th>审批意见</th>
            <td>
                <textarea name='group_content' placeholder="请输入内容" class="layui-textarea"></textarea>
            </td>
        </tr>


        <tr>
            <th></th>
            <td>
            	
                <button type="button" class="layui-btn layui-btn-normal save_form" style="" >提交</button>
                
                <input type="hidden" name="type" class="type"  value="{$Think.session.role_id}" />

                <input type="hidden" name="id" class="id"  value="{$data.id}" />
            </td>
        </tr>

    </tbody>
</table>
</form>

{/if}


<div style="height:150px;">&nbsp;</div>

{/block}

{block name="js"}
<script type="text/javascript" src="__JS__/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="__JS__/fancybox/jquery.fancybox-1.3.4.pack.js"></script>
<link rel="stylesheet" type="text/css" href="__JS__/fancybox/jquery.fancybox-1.3.4.css" media="screen" />

<script type="text/javascript">
/*
//微信点击图片
$(".qx_img img").click(function(){
    var img = $(this).attr("src");
    var img2= img.replace("!300","");
    wx.previewImage({
        current: img,
        urls: [img2]
    });
});
*/
$(function(){

    $("a.example").fancybox();
    
    $(".save_form").click(function(){
        var temp = $("#map input[type=radio]").val();
        if(temp==''){
            layer.alert("请选择是否通过!",{icon: 2},function(){
                //$(".title").focus();
            });
            return false;
        }

        var temp = $(".group_content").val();
        if(temp==''){
            layer.alert("请填写审批意见!",{icon: 2},function(){
                //$(".fault_code").focus();
            });
            return false;
        }

        var loading = layer.load(2, {shade: [0.5,'#fff']});
        $.post("{:url('service/ajax_service_show')}",$("#map").serialize(),function(data){
            layer.close(loading);
            //console.log(data.status);
            if(data.status){ 
                index = layer.alert('保存成功',{icon: 1},function(){
                    window.location.href = "{:url('service/service_list')}";
                });
            }else{
                layer.alert(data.msg,{icon: 2});
                //window.reload();
            }
        });

    });
    
});

</script>
{/block}
